[respond]
[include chopper_tune.cfg]
[include cartographer.cfg]
[include ebb36.cfg]
[include steppers.cfg]
[include x.cfg]
[include bedfans.cfg]
[include carto_calibrate.cfg]
[include temp.cfg]
[include motorsync.cfg]
[include autospeed.cfg]
[include mainsail.cfg]
[include KAMP_Settings.cfg]
[include timelapse.cfg]
[include macros.cfg]
[include tmc_autotune.cfg]
[include autospeed.cfg]
[include testspeed.cfg]
[include grease.cfg]
[include stealthburner_led.cfg]
#[include nis.cfg]
[include reshelper.cfg]
#[include nw.cfg]
#[iniclude sfs.cfg]

[mcu]
canbus_uuid: 0bfa866d29fd

[printer]
kinematics: corexy
max_velocity: 700
max_accel: 30000             #Max 4000
max_z_velocity: 50         #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 400
minimum_cruise_ratio: 0.5				# Default 0.5
square_corner_velocity:50.0

[input_shaper]
shaper_freq_x: 107.4
shaper_type_x: mzv
damping_ratio_x: 0.043
shaper_freq_y: 91.8
shaper_type_y: mzv
damping_ratio_y: 0.040

[extruder]
step_pin: ebb36: PD0
dir_pin: !ebb36: PD1
#sensor_type: ATC Semitec 104GT-2
sensor_type: EPCOS 100K B57560G104F 
sensor_pin: ebb36: TH0 #PA3 
enable_pin: !ebb36: PD2
heater_pin: ebb36: HE0
##  rotation_distance = <previous_rotation_distance> * <actual_extrude_distance> / 100 8.255
#rotation_distance: 4.5449275368 # 4.63768116 #34.778 #22.225371 #22.67895 #52.558275 #52.25 #53.59 #22.6789511  #22.23 #Bondtech 5mm Drive Gears
rotation_distance: 22.23 #47.088 #4.637 #
gear_ratio: 50:10 #9:1 #7.5:1 #50:10 #44:10 37:17 #50:17             # BMG Gear Ratio
microsteps: 16
full_steps_per_rotation: 200    #200 for 1.8 degree, 400 for 0.9 degree
nozzle_diameter: 0.500
filament_diameter: 1.75
max_extrude_only_distance: 500
max_extrude_only_velocity: 120 
min_temp: -20
max_temp: 300
min_extrude_temp: 170
#pressure_advance: 0.055 #0.052 #0.042
#pressure_advance_smooth_time: 0.04
max_extrude_cross_section: 5
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982

##  E0 on MOTOR6
[tmc2209 extruder]
uart_pin: ebb36: PA15
interpolate: true
run_current: 0.85
sense_resistor: 0.110
stealthchop_threshold: 0
driver_TBL: 0 
driver_HEND: 6 
driver_HSTRT: 7 
driver_TOFF: 4

[heater_bed]
heater_pin: PA3
sensor_type: Generic 3950
sensor_pin: PF3
max_power: 1.0
min_temp: 0
max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769

[idle_timeout]
timeout: 1800

[z_tilt]

z_positions:
   -50, 18
   175, 398
   400, 18
points:
   30, 5
   175, 295
   320, 5

speed: 300
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0025


[board_pins]
  aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,
  
    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>


[gcode_macro PRINT_START]
gcode:
    STATUS_HOMING
    LOWERCURRENT
    G28
    RESETCURRENT
    SYNC_MOTORS
    STATUS_READY
    BED_MESH_CLEAR
    BED_MESH_CALIBRATE
    CARTOGRAPHER_TOUCH
    M190 S{ params.BED }       ; Wait for bed to get to target temperature.
    M117 Preheating nozzle
    M109 S150                  ; Wait for nozzle to heat to 150C - soften filament, but no oozing.
    M107                       ; Print fan off
    #G1 X175 Y175 Z50 F5000.0
    STATUS_HEATING
    M117 Heating nozzle
    M109 S{ params.EXTRUDER }  ; Wait for nozzle to get to target temperature.
    G90                 ; Absolute coordinates.
    M83                 ; Relative extruder mode.
    STATUS_CLEANING
    #clean_nozzle
    STATUS_READY
    set_nozzle_leds_on
    #SET_FAN_SPEED FAN=Nevermore SPEED=0.7
    BED_MESH_PROFILE LOAD="default"    
    # G1 Z20 F3000                   ; move nozzle away from bed
    # G1 X10 Y20 Z0.3 F5000.0 ; move to start-line position
    # G1 X10 Y200.0 Z0.3 F1500.0 E15 ; draw 1st line
    # G1 X11 Y200.0 Z0.3 F5000.0 ; move to side a little
    # G1 X11 Y20 Z0.3 F1500.0 E30 ; draw 2nd line
    # G1 E27 F3000 ; retract filament 3mm
    # G92 E0 ; reset extruder
    # G1 Z1.0 F3000 ; move z up little to prevent scratching of surface
    LINE_PURGE

[gcode_macro PRINT_END]
gcode:
    # safe anti-stringing move coords
    {% set th = printer.toolhead %}
    {% set x_safe = th.position.x + 20 * (1 if th.axis_maximum.x - th.position.x > 20 else -1) %}
    {% set y_safe = th.position.y + 20 * (1 if th.axis_maximum.y - th.position.y > 20 else -1) %}
    {% set z_safe = [th.position.z + 2, th.axis_maximum.z]|min %}
    
    SAVE_GCODE_STATE NAME=STATE_PRINT_END

    M400                           ; wait for buffer to clear
    G92 E0                         ; zero the extruder
    G1 E-11.0 F3600                 ; retract filament
    TURN_OFF_HEATERS
    G90                                      ; absolute positioning
    G0 X{x_safe} Y{y_safe} Z{z_safe} F20000  ; move nozzle to remove stringing
    G0 X{th.axis_maximum.x//2} Y{th.axis_maximum.y - 2} F3600  ; park nozzle at rear
    M107                                     ; turn off fan
    BED_MESH_CLEAR
    SET_PIN PIN=caselight VALUE=0.20
    RESTORE_GCODE_STATE NAME=STATE_PRINT_END MOVE=0

[danger_options]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 35.966
#*# pid_ki = 4.927
#*# pid_kd = 65.641
#*# pid_version = 1
#*# pid_target = 260.00
#*# pid_tolerance = 0.0200
#*#
#*# [motors_sync]
#*# steps_model_x = quadratic,
#*# 	-970.6457968983249,
#*# 	25991.84731691398,
#*# 	2115.5684230633683
#*# steps_model_y = quadratic,
#*# 	-970.6457968983249,
#*# 	25991.84731691398,
#*# 	2115.5684230633683
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 56.904
#*# pid_ki = 1.903
#*# pid_kd = 425.357
#*# pid_version = 1
#*# pid_target = 110.00
#*# pid_tolerance = 0.0200
#*#
#*# [scanner model default]
#*# model_coef = 1.3136025005340215,
#*# 	1.7375049423455198,
#*# 	0.7795772455179069,
#*# 	0.3888789604565451,
#*# 	0.36627194774608257,
#*# 	0.3711100551024864,
#*# 	-0.18638408070369866,
#*# 	-0.30185761389858856,
#*# 	0.2766460617907376,
#*# 	0.2567082632387576
#*# model_domain = 3.1831128569550955e-07,3.3565300086181166e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 28.761921
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2500
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.070
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.048163, 0.045172, 0.043920, 0.039890, 0.034910, 0.034318, 0.028285, 0.026212, 0.026109, 0.028584, 0.029885, 0.032379, 0.035532, 0.038681, 0.038084, 0.038433, 0.033178, 0.030396, 0.024991, 0.018075, 0.014051, 0.009214, 0.007382, 0.005784, 0.000528, 0.000497, 0.000115, 0.000443, -0.000235, 0.000696, 0.004492
#*# 	0.046326, 0.045980, 0.042631, 0.037700, 0.033664, 0.030841, 0.027431, 0.028154, 0.026742, 0.028540, 0.031450, 0.033031, 0.033498, 0.032437, 0.030961, 0.027704, 0.023774, 0.019299, 0.015630, 0.010271, 0.007635, 0.004247, 0.003663, 0.000303, 0.000044, -0.000303, -0.000096, 0.000139, 0.001014, 0.002141, 0.004132
#*# 	0.049601, 0.051764, 0.048909, 0.046616, 0.042585, 0.036735, 0.031194, 0.027483, 0.026489, 0.024547, 0.026792, 0.027335, 0.029469, 0.028766, 0.028688, 0.026863, 0.024116, 0.019561, 0.015299, 0.010390, 0.007570, 0.004953, 0.004416, 0.002845, 0.001081, 0.000670, 0.001378, 0.001715, 0.002218, 0.004201, 0.008148
#*# 	0.052311, 0.051121, 0.047871, 0.045121, 0.039115, 0.037100, 0.031380, 0.030652, 0.027172, 0.028194, 0.025439, 0.026705, 0.025145, 0.024029, 0.019904, 0.018828, 0.013991, 0.011097, 0.008607, 0.006771, 0.004243, 0.004707, 0.004327, 0.003625, 0.002524, 0.003869, 0.005199, 0.005355, 0.008643, 0.008893, 0.009602
#*# 	0.052016, 0.054612, 0.052735, 0.049420, 0.045145, 0.040810, 0.033047, 0.030431, 0.024827, 0.023196, 0.022693, 0.021413, 0.019637, 0.020085, 0.017473, 0.015421, 0.013172, 0.008755, 0.007962, 0.004248, 0.002852, 0.001830, 0.001721, 0.003338, 0.003673, 0.004126, 0.006718, 0.007896, 0.010106, 0.012488, 0.014996
#*# 	0.053744, 0.053300, 0.049048, 0.045619, 0.039122, 0.036014, 0.029853, 0.027515, 0.023448, 0.020816, 0.018128, 0.017227, 0.015401, 0.013409, 0.009778, 0.009172, 0.005590, 0.005307, 0.003148, 0.003195, 0.003612, 0.002580, 0.004454, 0.003634, 0.007232, 0.009825, 0.010029, 0.013831, 0.013996, 0.015636, 0.017845
#*# 	0.055045, 0.056820, 0.055505, 0.054009, 0.048264, 0.042408, 0.035210, 0.027567, 0.025096, 0.020059, 0.019336, 0.015482, 0.014925, 0.013639, 0.011139, 0.009277, 0.008146, 0.005385, 0.004458, 0.003146, 0.001714, 0.004386, 0.004971, 0.007680, 0.009257, 0.012255, 0.014960, 0.016912, 0.018954, 0.021214, 0.022815
#*# 	0.057535, 0.057103, 0.052596, 0.048539, 0.042512, 0.037515, 0.030326, 0.025954, 0.020500, 0.018352, 0.015050, 0.012826, 0.011228, 0.008962, 0.008116, 0.006908, 0.004774, 0.006238, 0.004849, 0.004737, 0.005795, 0.006882, 0.009620, 0.011506, 0.015890, 0.017432, 0.020684, 0.022253, 0.023955, 0.024466, 0.026766
#*# 	0.056327, 0.060326, 0.057416, 0.053428, 0.049623, 0.043244, 0.034114, 0.029122, 0.021834, 0.019218, 0.015114, 0.012329, 0.010926, 0.008135, 0.009710, 0.007999, 0.007011, 0.005809, 0.005774, 0.003563, 0.003295, 0.004821, 0.007054, 0.009811, 0.013705, 0.016682, 0.020196, 0.023843, 0.023768, 0.027417, 0.027300
#*# 	0.056270, 0.055263, 0.051210, 0.046992, 0.041556, 0.036551, 0.029192, 0.024334, 0.018561, 0.015434, 0.012278, 0.010185, 0.008597, 0.008127, 0.006695, 0.006793, 0.004875, 0.006543, 0.004660, 0.004871, 0.006127, 0.006294, 0.010451, 0.011970, 0.019092, 0.019641, 0.022465, 0.025245, 0.025902, 0.025294, 0.027940
#*# 	0.052350, 0.055151, 0.051514, 0.048842, 0.044914, 0.040710, 0.031384, 0.023963, 0.018725, 0.014232, 0.012145, 0.009655, 0.007597, 0.008171, 0.006743, 0.005929, 0.006359, 0.004564, 0.005580, 0.002532, 0.003107, 0.003297, 0.005846, 0.009625, 0.012797, 0.015594, 0.017978, 0.022706, 0.022083, 0.024337, 0.026722
#*# 	0.047754, 0.047419, 0.043963, 0.039266, 0.035027, 0.028917, 0.022616, 0.019481, 0.012871, 0.009800, 0.007260, 0.006860, 0.006209, 0.005931, 0.004103, 0.005456, 0.004467, 0.004386, 0.005118, 0.003718, 0.004750, 0.004501, 0.009120, 0.011847, 0.014954, 0.016470, 0.019160, 0.021401, 0.021782, 0.023031, 0.024310
#*# 	0.040155, 0.043809, 0.041069, 0.038039, 0.034343, 0.029136, 0.020747, 0.015709, 0.011938, 0.007282, 0.005382, 0.004472, 0.003276, 0.004032, 0.004402, 0.004940, 0.004515, 0.005236, 0.005022, 0.002579, 0.003473, 0.002544, 0.002993, 0.006662, 0.008915, 0.012378, 0.012900, 0.016877, 0.017278, 0.019861, 0.021548
#*# 	0.035630, 0.035099, 0.030397, 0.025941, 0.021986, 0.017507, 0.012790, 0.008157, 0.005816, 0.002949, 0.002789, 0.002036, 0.002185, 0.002054, 0.002111, 0.003488, 0.004240, 0.003864, 0.004952, 0.004234, 0.003809, 0.003449, 0.005196, 0.007446, 0.010561, 0.011740, 0.012641, 0.016947, 0.014997, 0.017227, 0.020996
#*# 	0.030319, 0.031619, 0.027199, 0.023628, 0.020903, 0.015623, 0.010366, 0.004612, 0.001940, 0.001316, -0.000428, -0.000932, -0.001245, 0.001229, 0.001571, 0.001139, 0.004450, 0.004463, 0.004852, 0.004522, 0.003572, 0.002888, 0.002687, 0.004004, 0.004746, 0.007588, 0.010020, 0.012864, 0.014201, 0.015067, 0.018629
#*# 	0.020350, 0.019679, 0.013558, 0.011851, 0.006331, 0.004349, -0.000311, -0.002578, -0.004229, -0.004762, -0.003900, -0.002936, -0.001950, -0.001008, -0.001490, 0.000000, 0.000826, 0.002100, 0.002175, 0.002519, 0.000758, 0.001783, 0.001380, 0.005198, 0.005960, 0.008411, 0.007916, 0.012184, 0.013066, 0.015113, 0.017845
#*# 	0.014588, 0.014798, 0.011472, 0.009759, 0.007169, 0.004778, -0.001638, -0.001268, -0.005349, -0.005618, -0.006762, -0.004455, -0.005559, -0.003198, -0.001263, -0.000573, -0.001313, 0.000900, 0.001447, 0.001382, 0.000015, 0.000775, 0.000526, 0.003578, 0.003570, 0.007525, 0.008558, 0.012032, 0.012819, 0.015330, 0.017829
#*# 	0.008246, 0.006232, 0.004382, 0.001448, -0.000379, -0.000486, -0.003209, -0.005617, -0.007013, -0.006194, -0.005877, -0.006422, -0.002976, -0.002637, -0.002423, -0.001233, -0.001897, 0.001657, -0.000282, 0.000964, -0.000058, 0.002056, 0.001612, 0.006241, 0.007763, 0.010871, 0.010071, 0.014491, 0.013977, 0.017809, 0.020023
#*# 	0.006662, 0.006257, 0.003017, 0.002515, 0.000892, 0.000796, -0.004336, -0.001628, -0.006886, -0.004413, -0.005077, -0.004582, -0.004274, -0.003532, -0.001092, -0.000715, -0.000220, 0.001458, 0.000707, 0.000818, -0.000042, 0.001289, 0.002588, 0.004706, 0.006182, 0.010089, 0.013179, 0.015411, 0.016607, 0.018778, 0.023315
#*# 	0.000602, 0.000203, -0.000672, -0.001874, -0.002318, -0.002320, -0.001638, -0.003062, -0.002995, -0.004541, -0.003290, -0.004381, -0.001966, -0.002355, -0.001700, 0.000464, 0.000457, 0.001068, 0.000881, 0.002941, 0.003292, 0.005390, 0.006963, 0.008842, 0.012148, 0.015840, 0.015785, 0.020469, 0.019221, 0.022621, 0.025935
#*# 	0.000921, 0.000832, 0.000307, 0.000099, 0.002333, -0.000770, 0.001288, 0.000058, 0.001250, -0.000596, 0.001209, -0.000570, 0.001571, 0.001097, 0.001438, 0.002057, 0.003749, 0.005347, 0.005243, 0.005170, 0.006295, 0.007480, 0.009644, 0.012951, 0.015920, 0.018703, 0.022812, 0.024718, 0.026334, 0.027652, 0.031695
#*# 	-0.002666, -0.002270, -0.002143, -0.001698, -0.000507, 0.000901, 0.003126, 0.003150, 0.004881, 0.003655, 0.004722, 0.003480, 0.003588, 0.003745, 0.001807, 0.004810, 0.004899, 0.008261, 0.007087, 0.009299, 0.009381, 0.013807, 0.016309, 0.020697, 0.022292, 0.027376, 0.028586, 0.030857, 0.032039, 0.034782, 0.035658
#*# 	-0.005023, -0.001780, -0.003783, -0.001785, -0.000510, 0.001533, 0.003504, 0.006146, 0.007187, 0.009165, 0.009430, 0.010046, 0.009756, 0.009348, 0.008579, 0.008893, 0.007207, 0.010512, 0.010674, 0.011088, 0.011644, 0.013432, 0.015335, 0.021254, 0.022633, 0.027649, 0.030473, 0.033144, 0.037018, 0.037865, 0.041571
#*# 	-0.008549, -0.006258, -0.005202, -0.002901, 0.000488, 0.004438, 0.009007, 0.011560, 0.014633, 0.014547, 0.014839, 0.013254, 0.013782, 0.011143, 0.010861, 0.010730, 0.010270, 0.011226, 0.012162, 0.014934, 0.014898, 0.019361, 0.020848, 0.027193, 0.028519, 0.033186, 0.034183, 0.038641, 0.038736, 0.042600, 0.045924
#*# 	-0.011808, -0.008336, -0.007170, -0.003351, -0.000934, 0.004149, 0.006315, 0.011910, 0.015716, 0.018660, 0.018893, 0.019480, 0.015649, 0.016088, 0.014374, 0.014252, 0.012287, 0.013060, 0.012586, 0.013189, 0.015071, 0.015666, 0.018922, 0.023205, 0.026213, 0.030578, 0.034446, 0.037611, 0.039224, 0.044127, 0.047976
#*# 	-0.013660, -0.009229, -0.006960, -0.003174, 0.003617, 0.008371, 0.014939, 0.018191, 0.022715, 0.021952, 0.022791, 0.019436, 0.017776, 0.015070, 0.012385, 0.011710, 0.009816, 0.010431, 0.010221, 0.011163, 0.013268, 0.015950, 0.019255, 0.023663, 0.027310, 0.032230, 0.034449, 0.038172, 0.041353, 0.044747, 0.049087
#*# 	-0.016624, -0.010575, -0.009758, -0.005021, -0.001033, 0.007219, 0.010065, 0.018857, 0.019961, 0.024546, 0.025623, 0.026029, 0.022123, 0.019034, 0.016530, 0.014626, 0.012501, 0.012314, 0.009624, 0.009544, 0.011040, 0.011470, 0.015279, 0.019401, 0.022789, 0.028243, 0.032197, 0.035654, 0.039997, 0.043073, 0.049334
#*# 	-0.016097, -0.010588, -0.007017, -0.001468, 0.004596, 0.011518, 0.018264, 0.022424, 0.026181, 0.026271, 0.026971, 0.025493, 0.022743, 0.016865, 0.013585, 0.012721, 0.010404, 0.009237, 0.007441, 0.008866, 0.011686, 0.013409, 0.017725, 0.022251, 0.026283, 0.030752, 0.033868, 0.039073, 0.039664, 0.046690, 0.052925
#*# 	-0.015671, -0.011888, -0.009532, -0.004738, 0.001041, 0.007379, 0.013308, 0.018517, 0.023648, 0.027886, 0.028501, 0.030128, 0.027603, 0.024555, 0.020137, 0.016654, 0.014182, 0.013040, 0.010698, 0.008981, 0.010848, 0.011817, 0.014904, 0.019645, 0.021810, 0.028758, 0.033202, 0.037532, 0.039172, 0.044242, 0.051732
#*# 	-0.013347, -0.009658, -0.005879, -0.001619, 0.004999, 0.011799, 0.018616, 0.023972, 0.027280, 0.030286, 0.032857, 0.030709, 0.028717, 0.022703, 0.018150, 0.015295, 0.011716, 0.011426, 0.010334, 0.011536, 0.013428, 0.016212, 0.019140, 0.024045, 0.029191, 0.032994, 0.036568, 0.042743, 0.044100, 0.050471, 0.052977
#*# 	-0.017088, -0.011893, -0.010869, -0.007252, -0.003797, 0.003453, 0.006834, 0.015624, 0.020063, 0.025148, 0.031002, 0.031278, 0.030111, 0.027738, 0.024357, 0.019884, 0.016873, 0.013878, 0.012947, 0.011141, 0.012098, 0.015179, 0.015945, 0.022090, 0.026163, 0.030292, 0.035535, 0.042251, 0.043073, 0.048416, 0.053392
#*# x_count = 31
#*# y_count = 31
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 104.646
#*# max_x = 245.341
#*# min_y = 104.656
#*# max_y = 245.339
